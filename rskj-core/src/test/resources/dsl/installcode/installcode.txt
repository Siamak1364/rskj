account_new acc1 10000000000
account_new acc2 10000000000
# addr (acc1) = a0663f719962ec10bb57865532bef522059dfd96
# bytecode = 608060405234801561001057600080fd5b5060b78061001f6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c8063c298557814602d575b600080fd5b60336047565b604051603e9190605e565b60405180910390f35b60006103e7905090565b6058816077565b82525050565b6000602082019050607160008301846051565b92915050565b600081905091905056fea2646970667358221220d02cacd8546101f445fa7fbab7f1bee103e0285e57fbd03f4e3320cbe2a5f22264736f6c63430008070033

# Install Code

transaction_build tx01
    sender acc1
    receiverAddress 0000000000000000000000000000000001000011 # install code address
    value 0
    # install code params (address ++ bytecode)
    # todo(fedejinich) still need to check which the proper way to encode parameters
    data a0663f719962ec10bb57865532bef522059dfd96608060405234801561001057600080fd5b50610150806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80632e64cec11461003b5780636057361d14610059575b600080fd5b610043610075565b60405161005091906100d9565b60405180910390f35b610073600480360381019061006e919061009d565b61007e565b005b60008054905090565b8060008190555050565b60008135905061009781610103565b92915050565b6000602082840312156100b3576100b26100fe565b5b60006100c184828501610088565b91505092915050565b6100d3816100f4565b82525050565b60006020820190506100ee60008301846100ca565b92915050565b6000819050919050565b600080fd5b61010c816100f4565b811461011757600080fd5b5056fea26469706673582212202d9131e8fb724cebc1e67703df6f2e915ad50322ee3698c83c75249e923e2d5064736f6c63430008070033
    gas 2000000
    nonce 0
    build

transaction_build tx02
    sender acc2
    receiverAddress 00
    value 0
    data 608060405234801561001057600080fd5b50610268806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063c298557814610030575b600080fd5b61003861004e565b60405161004591906101c4565b60405180910390f35b600080600073a0663f719962ec10bb57865532bef522059dfd9673ffffffffffffffffffffffffffffffffffffffff166113886040516024016040516020818303038152906040527fc2985578000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161011191906101ad565b60006040518083038160008787f1925050503d806000811461014f576040519150601f19603f3d011682016040523d82523d6000602084013e610154565b606091505b50915091508161016357600080fd5b6103099250505090565b6000610178826101df565b61018281856101ea565b93506101928185602086016101ff565b80840191505092915050565b6101a7816101f5565b82525050565b60006101b9828461016d565b915081905092915050565b60006020820190506101d9600083018461019e565b92915050565b600081519050919050565b600081905092915050565b6000819050919050565b60005b8381101561021d578082015181840152602081019050610202565b8381111561022c576000848401525b5050505056fea2646970667358221220779f43551f3552466b3a8413317c88ad133151cc6b6bc9af8bbf60ec04972f5164736f6c63430008070033
    gas 2000000
    nonce 0
    build

block_build b01
    parent g00
    transactions tx01 tx02
    build

block_connect b01
assert_best b01
assert_tx_success tx01
assert_tx_success tx02

# Call Contract

transaction_build tx03
    sender acc2
    contract tx02
    value 0
    data c2985578 # foo()
    gas 2000000
    nonce 1
    build

block_build b02
    parent b01
    transactions tx03
    build

block_connect b02
assert_best b02
assert_tx_success tx03

comment
//source code
// SPDX-License-Identifier: GPL-3.0
pragma solidity >=0.7.0 <0.9.0;

contract InstalledCode {
   function foo() public pure returns (uint) {
        return 999;
    }
}

// SPDX-License-Identifier: GPL-3.0

pragma solidity >=0.7.0 <0.9.0;

// this one is invoked in tx03 (and deployed in tx02)
contract Caller {
    function foo() public returns (uint) {
        (bool success, bytes memory data) = address(0xA0663F719962EC10bB57865532beF522059dFD96)
                                                .call{gas: 5000}(
            abi.encodeWithSignature("foo()")
        );
        require(success);
        return 777;
    }
}
end
